(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const t of c.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&n(t)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();const y=document.getElementById("iconView"),l=document.getElementById("mapCanvas"),w=document.getElementById("divMessage"),p=document.getElementById("bSave");l.ondrop=e=>{var i;if(e.preventDefault(),(i=e.dataTransfer)!=null&&i.items){const r=Array.from(e.dataTransfer.items);x(r)}};l.ondragover=e=>{e.preventDefault()};p.onclick=()=>{{const e=document.createElement("a");e.download="image.png",e.href=l.toDataURL("image/png"),e.click()}{const e=new Blob([JSON.stringify(g)],{type:"application/json"}),i=document.createElement("a");i.download="image.json",i.href=window.URL.createObjectURL(e),i.click()}};var u=0,a=[],g;async function x(e){a=[],y.innerHTML="",console.log(e);const i=[];for(const n of e)n.kind==="file"&&i.push(n.getAsFile());for(const n of i)if(n){console.log(`File ${n.name}`),console.log(n.type);try{const o=await L(n);y.appendChild(o),console.log(`image size: ${o.width} x ${o.height}`),a.push({width:o.width,height:o.height,x:0,y:0,name:v(n.name),image:o})}catch(o){u++,console.error(`Cannot load image ${n.name}`),n.type==="image/svg+xml"&&console.log('For SVG file, make sure the xml namespace is included: xmlns="http://www.w3.org/2000/svg"'),console.log(o)}}a.sort((n,o)=>Math.max(o.width,o.height)-Math.max(n.width,n.height));const r=u?` <span style="color: red;">Errors: ${u}.</span>`:"";w.innerHTML=`Added ${a.length} icons.${r}`,O(1,1,256,256)}function v(e){const i=e.indexOf(".");return i>=0?e.substring(0,i):e}function L(e){const i=URL.createObjectURL(e);return new Promise((r,n)=>{let o=new Image;o.onload=()=>{URL.revokeObjectURL(i),r(o)},o.onerror=n,o.src=i})}function O(e,i,r,n){const o={x:i,y:i,w:r-i*2,h:n-i*2};function c(t,s){if(!t.sprite&&t.w>=e*2+s.width&&t.h>=e+s.height){t.sprite=s,s.x=t.x+e,s.y=t.y+e;const f=2*e+s.width,d=2*e+s.height,m=t.w-f,h=t.h-d;return m>=h?(t.first={x:t.x+f,y:t.y,w:m,h:d},t.second={x:t.x,y:t.y+d,w:t.w,h}):(t.second={x:t.x+f,y:t.y,w:m,h:t.h},t.first={x:t.x,y:t.y+d,w:f,h}),!0}else if(t.first&&c(t.first,s)||t.second&&c(t.second,s))return!0;return!1}for(const t of a)if(console.log(t.name),!c(o,t)){console.log(JSON.stringify(o,void 0,4)),alert("Error: did not allocate enough space for sprite");return}console.log(`Packed: w = ${r}, h = ${n}`),E(r,n),console.log(g),b(r,n)}function S(e){return{frame:{x:e.x,y:e.y,w:e.width,h:e.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:e.width,h:e.height},sourceSize:{w:e.width,h:e.height}}}function E(e,i){const r={};for(const n of a)r[n.name]=S(n);g={frames:r,meta:{app:"Sprite Mapper",version:"0.1",image:"icons.png",format:"RGBA8888",size:{w:e,h:i},scale:"1"}}}function b(e,i){l.width=e,l.height=i;const r=l.getContext("2d");for(const n of a)r.drawImage(n.image,n.x,n.y)}
