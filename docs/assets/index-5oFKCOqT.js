(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function c(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(o){if(o.ep)return;o.ep=!0;const r=c(o);fetch(o.href,r)}})();const m=document.getElementById("iconView"),l=document.getElementById("mapCanvas"),y=document.getElementById("divMessage"),p=document.getElementById("bSave");l.ondrop=e=>{var i;if(e.preventDefault(),(i=e.dataTransfer)!=null&&i.items){const c=Array.from(e.dataTransfer.items);x(c)}};l.ondragover=e=>{e.preventDefault()};p.onclick=()=>{{const e=document.createElement("a");e.download="image.png",e.href=l.toDataURL("image/png"),e.click()}{const e=new Blob([JSON.stringify(w)],{type:"application/json"}),i=document.createElement("a");i.download="image.json",i.href=window.URL.createObjectURL(e),i.click()}};var g=0,a=[],w;async function x(e){a=[],m.innerHTML="",console.log(e);const i=e.filter(t=>t.kind==="file").map(t=>t.getAsFile());i.sort((t,o)=>t.name.localeCompare(o.name));for(const t of i){console.log(`File ${t.name}`),console.log(t.type);try{const o=await L(t);m.appendChild(o);const r=document.createElement("div");r.innerText=`${o.width} x ${o.height}`,m.appendChild(r);const n=document.createElement("div");n.innerText=t.name,m.appendChild(n),console.log(`image size: ${o.width} x ${o.height}`),a.push({width:o.width,height:o.height,x:0,y:0,name:v(t.name),image:o})}catch(o){g++,console.error(`Cannot load image ${t.name}`),t.type==="image/svg+xml"&&console.log('For SVG file, make sure the xml namespace is included: xmlns="http://www.w3.org/2000/svg"'),console.log(o)}}a.sort((t,o)=>Math.max(o.width,o.height)-Math.max(t.width,t.height));const c=g?` <span style="color: red;">Errors: ${g}.</span>`:"";y.innerHTML=`Added ${a.length} icons.${c}`,E(1,1,256,256)}function v(e){const i=e.indexOf(".");return i>=0?e.substring(0,i):e}function L(e){const i=URL.createObjectURL(e);return new Promise((c,t)=>{let o=new Image;o.onload=()=>{URL.revokeObjectURL(i),c(o)},o.onerror=t,o.src=i})}function E(e,i,c,t){const o={x:i,y:i,w:c-i*2,h:t-i*2};function r(n,s){if(!n.sprite&&n.w>=e*2+s.width&&n.h>=e+s.height){n.sprite=s,s.x=n.x+e,s.y=n.y+e;const d=2*e+s.width,f=2*e+s.height,h=n.w-d,u=n.h-f;return h>=u?(n.first={x:n.x+d,y:n.y,w:h,h:f},n.second={x:n.x,y:n.y+f,w:n.w,h:u}):(n.second={x:n.x+d,y:n.y,w:h,h:n.h},n.first={x:n.x,y:n.y+f,w:d,h:u}),!0}else if(n.first&&r(n.first,s)||n.second&&r(n.second,s))return!0;return!1}for(const n of a)if(console.log(n.name),!r(o,n)){console.log(JSON.stringify(o,void 0,4)),alert("Error: did not allocate enough space for sprite");return}console.log(`Packed: w = ${c}, h = ${t}`),S(c,t),console.log(w),$(c,t)}function O(e){return{frame:{x:e.x,y:e.y,w:e.width,h:e.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:e.width,h:e.height},sourceSize:{w:e.width,h:e.height}}}function S(e,i){const c={};for(const t of a)c[t.name]=O(t);w={frames:c,meta:{app:"Sprite Mapper",version:"0.1",image:"icons.png",format:"RGBA8888",size:{w:e,h:i},scale:"1"}}}function $(e,i){l.width=e,l.height=i;const c=l.getContext("2d");for(const t of a)c.drawImage(t.image,t.x,t.y)}
